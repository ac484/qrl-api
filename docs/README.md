# Cloud Run + Redis + MEXC v3 API - QRL/USDT è‡ªå‹•äº¤æ˜“æ©Ÿå™¨äººè¨­è¨ˆæ–‡æª”

## ğŸ“‹ ç›®éŒ„
- [ç³»çµ±æ¶æ§‹è¨­è¨ˆ](#ç³»çµ±æ¶æ§‹è¨­è¨ˆ)
- [Redis é€£ç·šæ¶æ§‹](#redis-é€£ç·šæ¶æ§‹)
- [å®šæ™‚é‹è¡Œè¨­è¨ˆ](#å®šæ™‚é‹è¡Œè¨­è¨ˆ)
- [äº¤æ˜“æ©Ÿå™¨äººé‚è¼¯æµç¨‹](#äº¤æ˜“æ©Ÿå™¨äººé‚è¼¯æµç¨‹)
- [Redis æ•¸æ“šçµæ§‹è¨­è¨ˆ](#redis-æ•¸æ“šçµæ§‹è¨­è¨ˆ)
- [äº¤æ˜“ç­–ç•¥ç¤ºä¾‹](#äº¤æ˜“ç­–ç•¥ç¤ºä¾‹)
- [ç›£æ§èˆ‡å‘Šè­¦](#ç›£æ§èˆ‡å‘Šè­¦)
- [æˆæœ¬ä¼°ç®—](#æˆæœ¬ä¼°ç®—)
- [éƒ¨ç½²æ­¥é©Ÿæ¦‚è¦](#éƒ¨ç½²æ­¥é©Ÿæ¦‚è¦)
- [é‡è¦æ³¨æ„äº‹é …](#é‡è¦æ³¨æ„äº‹é …)

### æ–‡æª”ç´¢å¼•ï¼ˆå…¶ä»–æª”æ¡ˆï¼‰
- `ARCHITECTURE_TREE.md`ï¼šç›®æ¨™ç›®éŒ„çµæ§‹ï¼›æ­é… `ARCHITECTURE_RULES.md`ã€‚
- `03-Deployment.md`ï¼šéƒ¨ç½²ã€Secretsã€Scheduler åˆä½µæŒ‡å—ã€‚
- æ­·å² API/WebSocket åƒè€ƒï¼š`docs/archive/legacy-api/`ï¼ˆåªè®€å‚™ä»½ï¼‰ã€‚

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹è¨­è¨ˆ

### æ ¸å¿ƒçµ„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Cloud Scheduler (å®šæ™‚è§¸ç™¼)          â”‚
â”‚         æ¯åˆ†é˜/æ¯5åˆ†é˜/è‡ªå®šç¾©æ™‚é–“              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP POST
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Cloud Run Service                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   äº¤æ˜“æ©Ÿå™¨äººä¸»ç¨‹åº                    â”‚   â”‚
â”‚  â”‚  - æ¥æ”¶ Scheduler è§¸ç™¼                â”‚   â”‚
â”‚  â”‚  - åŸ·è¡Œäº¤æ˜“é‚è¼¯                       â”‚   â”‚
â”‚  â”‚  - è™•ç†è¨‚å–®                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚
           â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis (Memorystore) â”‚   â”‚  MEXC API v3     â”‚
â”‚  - äº¤æ˜“ç‹€æ…‹          â”‚   â”‚  - å¸‚å ´æ•¸æ“š       â”‚
â”‚  - åƒ¹æ ¼æ­·å²          â”‚   â”‚  - ä¸‹å–®/æŸ¥è©¢      â”‚
â”‚  - æŒå€‰ä¿¡æ¯          â”‚   â”‚  - é¤˜é¡æŸ¥è©¢       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Firestore (å¯é¸)                    â”‚
â”‚  - é•·æœŸäº¤æ˜“è¨˜éŒ„                               â”‚
â”‚  - ç­–ç•¥é…ç½®                                   â”‚
â”‚  - æ€§èƒ½çµ±è¨ˆ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ Redis é€£ç·šæ¶æ§‹

### å®Œæ•´é€£ç·šæ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GCP Project                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              VPC Network (è‡ªè¨‚ç¶²è·¯)                  â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚     Serverless VPC Access Connector          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚     (asia-southeast1)                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚     - IP Range: 10.8.0.0/28                  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚     - Min Instances: 2                       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚     - Max Instances: 10                      â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                 â”‚                                    â”‚   â”‚
â”‚  â”‚                 â”‚ å…§ç¶²é€£ç·š                           â”‚   â”‚
â”‚  â”‚                 â†“                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚         Cloud Run Service                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚     Container Instance                 â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                        â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚   Redis Client Library           â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚   (ioredis / redis-py)           â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚                                  â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - Connection Pool: 5-10        â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - Timeout: 5s                  â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - Retry: 3 æ¬¡                  â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - Keep-alive: 60s              â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              â”‚                         â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              â”‚ Redis å‘½ä»¤              â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              â†“                         â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                 â”‚                                â”‚   â”‚
â”‚  â”‚                 â”‚ é€šé VPC Connector              â”‚   â”‚
â”‚  â”‚                 â†“                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚   Memorystore for Redis (Managed)           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   å¯¦ä¾‹è©³æƒ…:                                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   - å±¤ç´š: Basic (å–®ç¯€é»)                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   - è¨˜æ†¶é«”: 1GB                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   - å€åŸŸ: asia-southeast1-a                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   - ç‰ˆæœ¬: Redis 7.0                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   - IP: 10.0.0.3 (å…§ç¶²)                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   - Port: 6379                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   - å¯†ç¢¼èªè­‰: å•Ÿç”¨                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚        Redis Data Structure          â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚                                      â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  Keys:                               â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  â”œâ”€ bot:qrl-usdt:status             â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  â”œâ”€ bot:qrl-usdt:position           â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  â”œâ”€ bot:qrl-usdt:price:latest       â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  â”œâ”€ bot:qrl-usdt:price:history      â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  â”œâ”€ bot:qrl-usdt:indicators:ma      â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  â”œâ”€ bot:qrl-usdt:indicators:rsi     â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  â”œâ”€ bot:qrl-usdt:trades:today       â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  â””â”€ bot:qrl-usdt:last-trade         â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â”‚                                      â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  å¤–éƒ¨é€£ç·š:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Cloud Run â”€â”€HTTPSâ”€â”€> MEXC API (api.mexc.com)        â”‚  â”‚
â”‚  â”‚                       - å¸‚å ´æ•¸æ“š API                   â”‚  â”‚
â”‚  â”‚                       - äº¤æ˜“ API                       â”‚  â”‚
â”‚  â”‚                       - å¸³æˆ¶ API                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Redis é€£ç·šé…ç½®è©³è§£

#### 1. VPC Connector é…ç½®

**ä½œç”¨:** è®“ Cloud Run (ç„¡ä¼ºæœå™¨) å¯ä»¥è¨ªå• VPC å…§çš„ Redis

```yaml
è³‡æºé…ç½®:
  åç¨±: trading-bot-connector
  å€åŸŸ: asia-southeast1
  ç¶²è·¯: default (æˆ–è‡ªè¨‚ VPC)
  IP ç¯„åœ: 10.8.0.0/28
  
æ“´å±•è¨­å®š:
  æœ€å°å¯¦ä¾‹æ•¸: 2
  æœ€å¤§å¯¦ä¾‹æ•¸: 10
  æ©Ÿå™¨é¡å‹: e2-micro
  
é€£ç·šé™åˆ¶:
  æœ€å¤§ååé‡: 300 Mbps (æ¯å€‹å¯¦ä¾‹)
  ä¸¦ç™¼é€£ç·š: 1000
```

#### 2. Redis é€£ç·šæ± è¨­å®š

**Node.js (ioredis) ç¯„ä¾‹é…ç½®:**

```typescript
{
  host: '10.0.0.3',
  port: 6379,
  password: process.env.REDIS_PASSWORD,
  
  // é€£ç·šæ± è¨­å®š
  maxRetriesPerRequest: 3,
  retryStrategy: (times) => Math.min(times * 50, 2000),
  
  // é€£ç·šä¿æŒ
  enableReadyCheck: true,
  keepAlive: 60000,
  
  // è¶…æ™‚è¨­å®š
  connectTimeout: 5000,
  commandTimeout: 3000,
  
  // é€£ç·šæ± å¤§å°
  lazyConnect: false,
  db: 0
}
```

**Python (redis-py) ç¯„ä¾‹é…ç½®:**

```python
{
    'host': '10.0.0.3',
    'port': 6379,
    'password': os.getenv('REDIS_PASSWORD'),
    'db': 0,
    
    # é€£ç·šæ± è¨­å®š
    'max_connections': 10,
    'socket_connect_timeout': 5,
    'socket_timeout': 3,
    'socket_keepalive': True,
    'socket_keepalive_options': {
        socket.TCP_KEEPIDLE: 60,
        socket.TCP_KEEPINTVL: 10,
        socket.TCP_KEEPCNT: 3
    },
    
    # é‡è©¦ç­–ç•¥
    'retry_on_timeout': True,
    'retry': Retry(ExponentialBackoff(), 3)
}
```

#### 3. é€£ç·šç”Ÿå‘½é€±æœŸ

```
Cloud Run å®¹å™¨å•Ÿå‹•
  â†“
åˆå§‹åŒ– Redis é€£ç·šæ±  (2-5å€‹é€£ç·š)
  â†“
åŸ·è¡Œ PING å‘½ä»¤é©—è­‰é€£ç·š
  â†“
[äº¤æ˜“å¾ªç’°é–‹å§‹]
  â†“
å¾é€£ç·šæ± å–å¾—é€£ç·š
  â†“
åŸ·è¡Œ Redis å‘½ä»¤ (GET/SET/LPUSH ç­‰)
  â†“
å‘½ä»¤åŸ·è¡Œå®Œæˆ,é€£ç·šè¿”å›æ± 
  â†“
[äº¤æ˜“å¾ªç’°çµæŸ]
  â†“
HTTP è«‹æ±‚å®Œæˆ,è¿”å›éŸ¿æ‡‰
  â†“
å®¹å™¨é–’ç½® (ä¿æŒé€£ç·šæ± æ´»èº)
  â†“
15åˆ†é˜ç„¡è«‹æ±‚ â†’ å®¹å™¨è‡ªå‹•éŠ·æ¯€
```

#### 4. é€£ç·šéŒ¯èª¤è™•ç†

```
Redis å‘½ä»¤åŸ·è¡Œ
  â†“
[å‘½ä»¤è¶…æ™‚/é€£ç·šæ–·é–‹]
  â†“
é‡è©¦æ©Ÿåˆ¶ (Retry 1)
  â”œâ”€ ç­‰å¾… 50ms
  â””â”€ é‡æ–°åŸ·è¡Œå‘½ä»¤
  â†“
[ä»ç„¶å¤±æ•—]
  â†“
é‡è©¦æ©Ÿåˆ¶ (Retry 2)
  â”œâ”€ ç­‰å¾… 100ms
  â””â”€ é‡æ–°åŸ·è¡Œå‘½ä»¤
  â†“
[ä»ç„¶å¤±æ•—]
  â†“
é‡è©¦æ©Ÿåˆ¶ (Retry 3)
  â”œâ”€ ç­‰å¾… 150ms
  â””â”€ é‡æ–°åŸ·è¡Œå‘½ä»¤
  â†“
[æœ€çµ‚å¤±æ•—]
  â†“
è¨˜éŒ„éŒ¯èª¤åˆ° Cloud Logging
  â†“
è¿”å›é™ç´šéŸ¿æ‡‰ (ä½¿ç”¨ Firestore å‚™ä»½æ•¸æ“š)
  â†“
ç™¼é€å‘Šè­¦é€šçŸ¥
```

### Redis æ€§èƒ½å„ªåŒ–

#### é€£ç·šæ± æœ€ä½³å¯¦è¸

| å ´æ™¯ | é€£ç·šæ± å¤§å° | åŸå›  |
|------|-----------|------|
| ä½é »äº¤æ˜“ (>5åˆ†é˜) | 2-3 | æ¸›å°‘è³‡æºæ¶ˆè€— |
| ä¸­é »äº¤æ˜“ (1-5åˆ†é˜) | 5-10 | å¹³è¡¡æ€§èƒ½èˆ‡æˆæœ¬ |
| é«˜é »äº¤æ˜“ (<1åˆ†é˜) | 10-20 | æœ€å¤§åŒ–ååé‡ |

#### å‘½ä»¤å„ªåŒ–å»ºè­°

1. **æ‰¹æ¬¡æ“ä½œ:** ä½¿ç”¨ Pipeline æ¸›å°‘å¾€è¿”æ¬¡æ•¸
   ```
   å–®å€‹å‘½ä»¤: 3 æ¬¡å¾€è¿” = 15ms
   Pipeline:  1 æ¬¡å¾€è¿” = 5ms (3å€é€Ÿåº¦æå‡)
   ```

2. **æ•¸æ“šçµæ§‹é¸æ“‡:**
   - åƒ¹æ ¼æ­·å²: ä½¿ç”¨ `LPUSH` + `LTRIM` (List)
   - æŒå€‰ç‹€æ…‹: ä½¿ç”¨ `HSET` (Hash)
   - äº¤æ˜“è¨ˆæ•¸: ä½¿ç”¨ `INCR` + `EXPIRE` (String)

3. **TTL ç­–ç•¥:**
   - å¯¦æ™‚æ•¸æ“š: 5åˆ†é˜
   - æ­·å²æ•¸æ“š: 1å°æ™‚
   - çµ±è¨ˆæ•¸æ“š: 24å°æ™‚

---

## âš™ï¸ å®šæ™‚é‹è¡Œè¨­è¨ˆ

### æ–¹æ¡ˆä¸€: Cloud Scheduler (æ¨è–¦)

**å„ªé»:**
- GCP åŸç”Ÿæœå‹™,å…ç®¡ç†
- ç²¾ç¢ºçš„ Cron è¡¨é”å¼
- è‡ªå‹•é‡è©¦æ©Ÿåˆ¶
- æˆæœ¬ä½å»‰

**é…ç½®ç¤ºä¾‹:**

```yaml
è§¸ç™¼é »ç‡é¸é …:
  é«˜é »äº¤æ˜“: "*/1 * * * *"     # æ¯åˆ†é˜
  ä¸­é »äº¤æ˜“: "*/5 * * * *"     # æ¯5åˆ†é˜
  ä½é »äº¤æ˜“: "*/15 * * * *"    # æ¯15åˆ†é˜
  è‡ªå®šç¾©:   "0 */4 * * *"     # æ¯4å°æ™‚
  
HTTP ç›®æ¨™è¨­å®š:
  URL: https://trading-bot-xxxxxx.run.app/execute
  æ–¹æ³•: POST
  æ¨™é ­:
    - Content-Type: application/json
  Body:
    {
      "pair": "QRL/USDT",
      "strategy": "ma-crossover"
    }
  
é‡è©¦è¨­å®š:
  æœ€å¤§é‡è©¦: 3
  é‡è©¦é–“éš”: 1åˆ†é˜
  è¶…æ™‚æ™‚é–“: 60ç§’
```

**å·¥ä½œæµç¨‹:**

```
Cloud Scheduler (æ¯åˆ†é˜è§¸ç™¼)
  â†“
ç™¼é€ HTTP POST åˆ° Cloud Run
  â†“
Cloud Run å®¹å™¨å•Ÿå‹• (å†·å•Ÿå‹• <1ç§’)
  â†“
åŸ·è¡Œäº¤æ˜“é‚è¼¯ (5-30ç§’)
  â†“
è¿”å› HTTP 200 éŸ¿æ‡‰
  â†“
å®¹å™¨ä¿æŒæ´»èº 15åˆ†é˜
  â†“
ç„¡æ–°è«‹æ±‚ â†’ è‡ªå‹•ç¸®å®¹åˆ° 0
```

### æ–¹æ¡ˆäºŒ: Cloud Run Jobs (æ‰¹æ¬¡ä»»å‹™)

**å„ªé»:**
- é©åˆé•·æ™‚é–“é‹è¡Œçš„åˆ†æä»»å‹™
- å¯ä»¥æ‰‹å‹•è§¸ç™¼
- æ›´å¥½çš„æ—¥èªŒç®¡ç†

**ä½¿ç”¨å ´æ™¯:**
- æ¯æ—¥ç­–ç•¥å›æ¸¬
- å¸‚å ´æ•¸æ“šåˆ†æ
- é€±æœŸæ€§å€‰ä½èª¿æ•´

**é…ç½®ç¯„ä¾‹:**

```yaml
Job åç¨±: daily-market-analysis
åŸ·è¡Œé »ç‡: "0 0 * * *"  # æ¯æ—¥å‡Œæ™¨
è¶…æ™‚æ™‚é–“: 3600s (1å°æ™‚)
ä¸¦è¡Œæ•¸: 1
é‡è©¦æ¬¡æ•¸: 2

ä»»å‹™:
  - ä¸‹è¼‰éå»24å°æ™‚æ•¸æ“š
  - è¨ˆç®—æŠ€è¡“æŒ‡æ¨™
  - ç”Ÿæˆäº¤æ˜“ä¿¡è™Ÿ
  - æ›´æ–°ç­–ç•¥åƒæ•¸
```

---

## ğŸ”„ äº¤æ˜“æ©Ÿå™¨äººé‚è¼¯æµç¨‹

### å®Œæ•´åŸ·è¡Œæµç¨‹ (20ç§’å…§å®Œæˆ)

#### Phase 1: å•Ÿå‹•éšæ®µ (0-2ç§’)

```
æ¥æ”¶ Scheduler HTTP è«‹æ±‚
  â†“
é©—è­‰è«‹æ±‚ä¾†æº (æª¢æŸ¥ Authorization Header)
  â†“
å¾ Redis è¼‰å…¥æ©Ÿå™¨äººç‹€æ…‹
  â”œâ”€ GET bot:qrl-usdt:status
  â””â”€ å¦‚æœ = "paused" â†’ ç›´æ¥è¿”å›
  â†“
åˆå§‹åŒ– MEXC API å®¢æˆ¶ç«¯
  â”œâ”€ è¼‰å…¥ API Key (Secret Manager)
  â””â”€ æ¸¬è©¦é€£ç·š (ping API)
```

#### Phase 2: æ•¸æ“šæ¡é›† (2-5ç§’)

```
ä¸¦è¡Œè«‹æ±‚ MEXC API:
  â”œâ”€ GET /api/v3/ticker/24hr?symbol=QRLUSDT
  â”‚   â†’ å–å¾—æœ€æ–°åƒ¹æ ¼ã€24å°æ™‚æˆäº¤é‡
  â”‚
  â”œâ”€ GET /api/v3/account
  â”‚   â†’ å–å¾—å¸³æˆ¶é¤˜é¡ (USDT, QRL)
  â”‚
  â””â”€ GET /api/v3/openOrders?symbol=QRLUSDT
      â†’ å–å¾—ç•¶å‰æ›å–®
  â†“
æ•¸æ“šå¯«å…¥ Redis (Pipeline æ‰¹æ¬¡å¯«å…¥):
  â”œâ”€ SET bot:qrl-usdt:price:latest {price} EX 300
  â”œâ”€ LPUSH bot:qrl-usdt:price:history {price}
  â”œâ”€ LTRIM bot:qrl-usdt:price:history 0 99
  â”œâ”€ HSET bot:qrl-usdt:balance usdt {usdt_amount}
  â””â”€ HSET bot:qrl-usdt:balance qrl {qrl_amount}
```

#### Phase 3: ç­–ç•¥åˆ¤æ–· (5-8ç§’)

```
å¾ Redis è®€å–æ­·å²æ•¸æ“š:
  â”œâ”€ LRANGE bot:qrl-usdt:price:history 0 99
  â””â”€ GET bot:qrl-usdt:position
  â†“
è¨ˆç®—æŠ€è¡“æŒ‡æ¨™:
  â”œâ”€ MA(5) = SUM(æœ€è¿‘5å€‹åƒ¹æ ¼) / 5
  â”œâ”€ MA(20) = SUM(æœ€è¿‘20å€‹åƒ¹æ ¼) / 20
  â”œâ”€ RSI(14) = 100 - (100 / (1 + RS))
  â””â”€ MACD = EMA(12) - EMA(26)
  â†“
å­˜å„²æŒ‡æ¨™åˆ° Redis:
  â”œâ”€ SET bot:qrl-usdt:indicators:ma5 {value}
  â”œâ”€ SET bot:qrl-usdt:indicators:ma20 {value}
  â””â”€ SET bot:qrl-usdt:indicators:rsi {value}
  â†“
ç”Ÿæˆäº¤æ˜“ä¿¡è™Ÿ:
  IF (MA5 > MA20) AND (å‰æ¬¡ MA5 < MA20):
    ä¿¡è™Ÿ = BUY
  ELSE IF (MA5 < MA20) AND (å‰æ¬¡ MA5 > MA20):
    ä¿¡è™Ÿ = SELL
  ELSE:
    ä¿¡è™Ÿ = HOLD
```

#### Phase 4: é¢¨éšªæ§åˆ¶ (8-10ç§’)

```
é¢¨éšªæª¢æŸ¥æ¸…å–®:
  â”œâ”€ æª¢æŸ¥ 1: é¤˜é¡æ˜¯å¦è¶³å¤ ?
  â”‚   â””â”€ IF USDTé¤˜é¡ < 10 â†’ å–æ¶ˆäº¤æ˜“
  â”‚
  â”œâ”€ æª¢æŸ¥ 2: ä»Šæ—¥äº¤æ˜“æ¬¡æ•¸é™åˆ¶
  â”‚   â”œâ”€ GET bot:qrl-usdt:trades:today
  â”‚   â””â”€ IF æ¬¡æ•¸ >= 5 â†’ å–æ¶ˆäº¤æ˜“
  â”‚
  â”œâ”€ æª¢æŸ¥ 3: å€‰ä½é™åˆ¶
  â”‚   â”œâ”€ è¨ˆç®—ç•¶å‰æŒå€‰ä½”ç¸½è³‡ç”¢æ¯”ä¾‹
  â”‚   â””â”€ IF æ¯”ä¾‹ > 30% â†’ é™ä½äº¤æ˜“é‡
  â”‚
  â”œâ”€ æª¢æŸ¥ 4: åƒ¹æ ¼æ³¢å‹•æª¢æŸ¥
  â”‚   â”œâ”€ è¨ˆç®—æœ€è¿‘5åˆ†é˜æ³¢å‹•ç‡
  â”‚   â””â”€ IF æ³¢å‹•ç‡ > 5% â†’ æš«åœäº¤æ˜“
  â”‚
  â””â”€ æª¢æŸ¥ 5: å†·å»æœŸ
      â”œâ”€ GET bot:qrl-usdt:last-trade
      â””â”€ IF è·é›¢ä¸Šæ¬¡äº¤æ˜“ < 3åˆ†é˜ â†’ å–æ¶ˆäº¤æ˜“
  â†“
è¨ˆç®—è¨‚å–®æ•¸é‡:
  IF ä¿¡è™Ÿ = BUY:
    äº¤æ˜“é‡‘é¡ = MIN(USDTé¤˜é¡ * 0.1, 50 USDT)
    QRLæ•¸é‡ = äº¤æ˜“é‡‘é¡ / ç•¶å‰åƒ¹æ ¼
  ELSE IF ä¿¡è™Ÿ = SELL:
    QRLæ•¸é‡ = QRLé¤˜é¡ * 0.5
```

#### Phase 5: åŸ·è¡Œäº¤æ˜“ (10-15ç§’)

```
IF ä¿¡è™Ÿ = BUY:
  â”œâ”€ æº–å‚™è¨‚å–®åƒæ•¸:
  â”‚   {
  â”‚     symbol: "QRLUSDT",
  â”‚     side: "BUY",
  â”‚     type: "MARKET",
  â”‚     quantity: {è¨ˆç®—å‡ºçš„æ•¸é‡}
  â”‚   }
  â”‚
  â”œâ”€ POST /api/v3/order ä¸‹å–®
  â”‚   â”œâ”€ ç­‰å¾… API éŸ¿æ‡‰ (1-3ç§’)
  â”‚   â””â”€ å–å¾— orderId
  â”‚
  â”œâ”€ è¼ªè©¢è¨‚å–®ç‹€æ…‹ (æœ€å¤š5æ¬¡):
  â”‚   â””â”€ GET /api/v3/order?orderId={orderId}
  â”‚       â””â”€ ç›´åˆ° status = "FILLED"
  â”‚
  â””â”€ æ›´æ–° Redis æŒå€‰:
      â”œâ”€ HSET bot:qrl-usdt:position avg_price {æˆäº¤åƒ¹}
      â”œâ”€ HSET bot:qrl-usdt:position quantity {æ•¸é‡}
      â”œâ”€ SET bot:qrl-usdt:last-trade {timestamp}
      â””â”€ INCR bot:qrl-usdt:trades:today
  â†“
ELSE IF ä¿¡è™Ÿ = SELL:
  â””â”€ (åŒä¸Š,ä½† side = "SELL")
  â†“
ELSE (HOLD):
  â””â”€ è¨˜éŒ„æ—¥èªŒ: "ç„¡äº¤æ˜“ä¿¡è™Ÿ,ä¿æŒæŒæœ‰"
```

#### Phase 6: è¨˜éŒ„èˆ‡æ¸…ç† (15-20ç§’)

```
è¨ˆç®—æœ¬æ¬¡äº¤æ˜“ç›ˆè™§:
  IF æœ‰æˆäº¤:
    ç›ˆè™§ = (è³£å‡ºåƒ¹ - è²·å…¥åƒ¹) * æ•¸é‡ - æ‰‹çºŒè²»
  â†“
æ›´æ–°çµ±è¨ˆæ•¸æ“š (Redis):
  â”œâ”€ HINCRBY bot:qrl-usdt:stats total_trades 1
  â”œâ”€ HINCRBYFLOAT bot:qrl-usdt:stats total_pnl {ç›ˆè™§}
  â””â”€ HSET bot:qrl-usdt:stats last_update {timestamp}
  â†“
å¯«å…¥é•·æœŸè¨˜éŒ„ (Firestore):
  Collection: trades
  Document: {
    timestamp: "2025-12-27T10:30:00Z",
    pair: "QRL/USDT",
    side: "BUY",
    price: 0.1234,
    quantity: 100,
    fee: 0.05,
    pnl: 1.23,
    strategy: "ma-crossover"
  }
  â†“
ç™¼é€é€šçŸ¥ (å¯é¸):
  IF äº¤æ˜“æˆåŠŸ:
    â””â”€ ç™¼é€ Telegram è¨Šæ¯:
        "âœ… è²·å…¥ 100 QRL @ 0.1234
        ğŸ’° å¸³æˆ¶é¤˜é¡: 450 USDT"
  â†“
è¿”å› HTTP 200 éŸ¿æ‡‰:
  {
    "status": "success",
    "signal": "BUY",
    "executed": true,
    "price": 0.1234,
    "quantity": 100,
    "execution_time": "18.5s"
  }
```

---

## ğŸ’¾ Redis æ•¸æ“šçµæ§‹è¨­è¨ˆ

### Key å‘½åè¦ç¯„

#### 1. ç³»çµ±ç‹€æ…‹é¡

```redis
# æ©Ÿå™¨äººé‹è¡Œç‹€æ…‹
bot:qrl-usdt:status
é¡å‹: String
å€¼: "running" | "paused" | "error"
TTL: ç„¡ (æ°¸ä¹…)

# æœ€å¾Œå¿ƒè·³æ™‚é–“
bot:qrl-usdt:heartbeat
é¡å‹: String
å€¼: Unix timestamp
TTL: 300ç§’ (5åˆ†é˜)
```

#### 2. åƒ¹æ ¼æ•¸æ“šé¡

```redis
# æœ€æ–°åƒ¹æ ¼
bot:qrl-usdt:price:latest
é¡å‹: String
å€¼: "0.1234"
TTL: 300ç§’ (5åˆ†é˜)
ç¯„ä¾‹: SET bot:qrl-usdt:price:latest "0.1234" EX 300

# åƒ¹æ ¼æ­·å² (æœ€å¤š100æ¢)
bot:qrl-usdt:price:history
é¡å‹: List
å€¼: ["0.1234", "0.1235", "0.1233", ...]
æ“ä½œ:
  - LPUSH bot:qrl-usdt:price:history "0.1234"
  - LTRIM bot:qrl-usdt:price:history 0 99
  - LRANGE bot:qrl-usdt:price:history 0 19  # å–æœ€è¿‘20æ¢

# åƒ¹æ ¼æ™‚é–“æˆ³è¨˜éŒ„
bot:qrl-usdt:price:timestamps
é¡å‹: List
å€¼: ["1735294200", "1735294260", ...]
æ“ä½œ: èˆ‡ price:history åŒæ­¥ç¶­è­·
```

#### 3. å¸³æˆ¶æ•¸æ“šé¡

```redis
# å¸³æˆ¶é¤˜é¡ (Hashçµæ§‹)
bot:qrl-usdt:balance
é¡å‹: Hash
æ¬„ä½:
  - usdt: "450.25"
  - qrl: "1000.00"
  - total_value: "550.75"  # USDTç­‰å€¼
æ“ä½œ:
  - HSET bot:qrl-usdt:balance usdt "450.25"
  - HGET bot:qrl-usdt:balance usdt
  - HGETALL bot:qrl-usdt:balance

# ç•¶å‰æŒå€‰ (Hashçµæ§‹)
bot:qrl-usdt:position
é¡å‹: Hash
æ¬„ä½:
  - quantity: "1000.00"      # æŒæœ‰æ•¸é‡
  - avg_price: "0.1234"      # å¹³å‡æˆæœ¬
  - total_cost: "123.40"     # ç¸½æˆæœ¬
  - unrealized_pnl: "12.34"  # æœªå¯¦ç¾ç›ˆè™§
æ“ä½œ:
  - HSET bot:qrl-usdt:position quantity "1000"
  - HMGET bot:qrl-usdt:position quantity avg_price
```

#### 4. æŠ€è¡“æŒ‡æ¨™é¡

```redis
# ç§»å‹•å¹³å‡ç·š
bot:qrl-usdt:indicators:ma5
bot:qrl-usdt:indicators:ma20
bot:qrl-usdt:indicators:ma50
é¡å‹: String
å€¼: "0.1234"
TTL: 600ç§’ (10åˆ†é˜)

# RSI æŒ‡æ¨™
bot:qrl-usdt:indicators:rsi
é¡å‹: String
å€¼: "65.43"
TTL: 600ç§’

# MACD æŒ‡æ¨™
bot:qrl-usdt:indicators:macd
é¡å‹: Hash
æ¬„ä½:
  - macd: "0.0012"
  - signal: "0.0010"
  - histogram: "0.0002"
TTL: 600ç§’
```

#### 5. äº¤æ˜“è¨˜éŒ„é¡

```redis
# ä»Šæ—¥äº¤æ˜“æ¬¡æ•¸
bot:qrl-usdt:trades:today
é¡å‹: String (Counter)
å€¼: "3"
TTL: åˆ°ç•¶æ—¥åˆå¤œ (ä½¿ç”¨ EXPIREAT)
æ“ä½œ:
  - INCR bot:qrl-usdt:trades:today
  - EXPIREAT bot:qrl-usdt:trades:today {midnight_timestamp}

# æœ€å¾Œäº¤æ˜“æ™‚é–“
bot:qrl-usdt:last-trade
é¡å‹: String
å€¼: "1735294200"  # Unix timestamp
TTL: ç„¡

# æœ€å¾Œäº¤æ˜“è©³æƒ…
bot:qrl-usdt:last-trade:detail
é¡å‹: Hash
æ¬„ä½:
  - side: "BUY"
  - price: "0.1234"
  - quantity: "100"
  - fee: "0.05"
  - timestamp: "1735294200"
TTL: 86400ç§’ (24å°æ™‚)
```

#### 6. çµ±è¨ˆæ•¸æ“šé¡

```redis
# çµ±è¨ˆæ•¸æ“š (Hashçµæ§‹)
bot:qrl-usdt:stats
é¡å‹: Hash
æ¬„ä½:
  - total_trades: "127"          # ç¸½äº¤æ˜“æ¬¡æ•¸
  - total_pnl: "45.67"          # ç¸½ç›ˆè™§
  - win_trades: "78"            # ç›ˆåˆ©äº¤æ˜“æ•¸
  - loss_trades: "49"           # è™§æäº¤æ˜“æ•¸
  - win_rate: "0.6141"          # å‹ç‡
  - max_drawdown: "-12.34"      # æœ€å¤§å›æ’¤
  - last_update: "1735294200"   # æœ€å¾Œæ›´æ–°æ™‚é–“
TTL: ç„¡ (æ°¸ä¹…ä¿å­˜)

# æ¯æ—¥çµ±è¨ˆ (æŒ‰æ—¥æœŸåˆ†å‰²)
bot:qrl-usdt:stats:2025-12-27
é¡å‹: Hash
æ¬„ä½: (åŒä¸Š,ä½†åƒ…é‡å°ç•¶æ—¥)
TTL: 2592000ç§’ (30å¤©)
```

#### 7. é¢¨æ§æ•¸æ“šé¡

```redis
# å†·å»æœŸæ¨™è¨˜
bot:qrl-usdt:cooldown
é¡å‹: String
å€¼: "1"
TTL: 180ç§’ (3åˆ†é˜å†·å»æœŸ)
æ“ä½œ:
  - SETEX bot:qrl-usdt:cooldown 180 "1"
  - EXISTS bot:qrl-usdt:cooldown  # æª¢æŸ¥æ˜¯å¦åœ¨å†·å»æœŸ

# é€£çºŒè™§ææ¬¡æ•¸
bot:qrl-usdt:consecutive-losses
é¡å‹: String
å€¼: "2"
TTL: ç„¡ (æ‰‹å‹•é‡ç½®)

# æ¯æ—¥è™§æé¡
bot:qrl-usdt:daily-loss
é¡å‹: String
å€¼: "-15.23"
TTL: åˆ°ç•¶æ—¥åˆå¤œ
```

### å®Œæ•´æ“ä½œç¯„ä¾‹

#### å¯«å…¥åƒ¹æ ¼æ•¸æ“š (Pipeline æ‰¹æ¬¡æ“ä½œ)

```python
pipe = redis.pipeline()

# 1. æ›´æ–°æœ€æ–°åƒ¹æ ¼
pipe.set('bot:qrl-usdt:price:latest', '0.1234', ex=300)

# 2. æ·»åŠ åˆ°æ­·å²è¨˜éŒ„
pipe.lpush('bot:qrl-usdt:price:history', '0.1234')
pipe.ltrim('bot:qrl-usdt:price:history', 0, 99)

# 3. æ·»åŠ æ™‚é–“æˆ³
pipe.lpush('bot:qrl-usdt:price:timestamps', '1735294200')
pipe.ltrim('bot:qrl-usdt:price:timestamps', 0, 99)

# 4. æ›´æ–°å¿ƒè·³
pipe.set('bot:qrl-usdt:heartbeat', '1735294200', ex=300)

# åŸ·è¡Œæ‰€æœ‰å‘½ä»¤ (åƒ…1æ¬¡ç¶²è·¯å¾€è¿”)
pipe.execute()
```

#### è®€å–å®Œæ•´ç‹€æ…‹

```python
# ä½¿ç”¨ Pipeline æ‰¹æ¬¡è®€å–
pipe = redis.pipeline()

pipe.get('bot:qrl-usdt:status')
pipe.get('bot:qrl-usdt:price:latest')
pipe.lrange('bot:qrl-usdt:price:history', 0, 19)
pipe.hgetall('bot:qrl-usdt:balance')
pipe.hgetall('bot:qrl-usdt:position')
pipe.get('bot:qrl-usdt:trades:today')
pipe.hgetall('bot:qrl-usdt:stats')

results = pipe.execute()

# è§£æçµæœ
state = {
    'status': results[0],
    'latest_price': float(results[1]),
    'price_history': [float(p) for p in results[2]],
    'balance': results[3],
    'position': results[4],
    'trades_today': int(results[5] or 0),
    'stats': results[6]
}
```

---

## ğŸ¯ äº¤æ˜“ç­–ç•¥ç¤ºä¾‹

### ç­–ç•¥ 1: ç°¡å–®ç§»å‹•å¹³å‡ç·šäº¤å‰ (MA Crossover)

#### ç­–ç•¥é‚è¼¯

```
é€²å ´æ¢ä»¶ (è²·å…¥):
  1. MA(5) å¾ä¸‹æ–¹çªç ´ MA(20)
  2. RSI > 30 (ä¸åœ¨è¶…è³£å€)
  3. æˆäº¤é‡ > å¹³å‡æˆäº¤é‡çš„ 1.2å€
  4. å¸³æˆ¶ USDT é¤˜é¡ >= 10

å‡ºå ´æ¢ä»¶ (è³£å‡º):
  1. MA(5) å¾ä¸Šæ–¹è·Œç ´ MA(20)
  OR
  2. åƒ¹æ ¼é”åˆ°æ­¢ç›ˆç›®æ¨™ (+5%)
  OR
  3. åƒ¹æ ¼é”åˆ°æ­¢æç›®æ¨™ (-3%)

æŒæœ‰æ¢ä»¶:
  - MA(5) èˆ‡ MA(20) æœªç™¼ç”Ÿäº¤å‰
  - åœæ/åœåˆ©æœªè§¸ç™¼
```

#### é¢¨æ§åƒæ•¸

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|-----|------|
| å–®ç­†æœ€å¤§æŠ•å…¥ | å¸³æˆ¶çš„ 10% | é™ä½å–®æ¬¡é¢¨éšª |
| æ­¢ææ¯”ä¾‹ | -3% | è™§æ3%è‡ªå‹•è³£å‡º |
| æ­¢ç›ˆæ¯”ä¾‹ | +5% | ç›ˆåˆ©5%è‡ªå‹•è³£å‡º |
| æ¯æ—¥æœ€å¤§äº¤æ˜“æ¬¡æ•¸ | 5æ¬¡ | é¿å…éåº¦äº¤æ˜“ |
| å†·å»æœŸ | 3åˆ†é˜ | é¿å…é »ç¹äº¤æ˜“ |
| æœ€å¤§å€‰ä½ | ç¸½è³‡ç”¢çš„ 30% | ä¿ç•™æµå‹•æ€§ |

#### å¯¦ä½œå½ä»£ç¢¼

```python
def ma_crossover_strategy():
    # 1. å–å¾—æ•¸æ“š
    prices = redis.lrange('bot:qrl-usdt:price:history', 0, 49)
    
    # 2. è¨ˆç®—æŒ‡æ¨™
    ma5 = calculate_ma(prices[:5])
    ma20 = calculate_ma(prices[:20])
    prev_ma5 = calculate_ma(prices[1:6])
    prev_ma20 = calculate_ma(prices[1:21])
    
    rsi = calculate_rsi(prices[:14])
    volume = get_current_volume()
    avg_volume = calculate_average_volume()
    
    # 3. æª¢æŸ¥äº¤å‰
    bullish_cross = (ma5 > ma20) and (prev_ma5 <= prev_ma20)
    bearish_cross = (ma5 < ma20) and (prev_ma5 >= prev_ma20)
    
    # 4. ç”Ÿæˆä¿¡è™Ÿ
    if bullish_cross and rsi > 30 and volume > avg_volume * 1.2:
        return "BUY"
    elif bearish_cross:
        return "SELL"
    else:
        # æª¢æŸ¥æ­¢ç›ˆæ­¢æ
        position = redis.hgetall('bot:qrl-usdt:position')
        if position:
            current_price = float(redis.get('bot:qrl-usdt:price:latest'))
            avg_price = float(position['avg_price'])
            pnl_percent = (current_price - avg_price) / avg_price * 100
            
            if pnl_percent >= 5:
                return "SELL"  # æ­¢ç›ˆ
            elif pnl_percent <= -3:
                return "SELL"  # æ­¢æ
        
        return "HOLD"
```

### ç­–ç•¥ 2: RSI è¶…è²·è¶…è³£

#### ç­–ç•¥é‚è¼¯

```
é€²å ´æ¢ä»¶ (è²·å…¥):
  1. RSI(14) < 30 (è¶…è³£å€)
  2. åƒ¹æ ¼é€£çºŒ3æ ¹Kç·šä¸‹è·Œ
  3. åƒ¹æ ¼è·Œç ´ä¸‹è»Œ Bollinger Band

å‡ºå ´æ¢ä»¶ (è³£å‡º):
  1. RSI(14) > 70 (è¶…è²·å€)
  2. åƒ¹æ ¼é€£çºŒ3æ ¹Kç·šä¸Šæ¼²
  3. åƒ¹æ ¼çªç ´ä¸Šè»Œ Bollinger Band

æŒæœ‰æ¢ä»¶:
  - 30 <= RSI <= 70 (ä¸­æ€§å€)
```

#### é¢¨æ§åƒæ•¸

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|-----|------|
| å–®ç­†æœ€å¤§æŠ•å…¥ | å¸³æˆ¶çš„ 15% | ç¨å¾®æ¿€é€² |
| æ­¢ææ¯”ä¾‹ | -2% | è¼ƒç·Šçš„æ­¢æ |
| æ­¢ç›ˆæ¯”ä¾‹ | +4% | å¿«é€Ÿç²åˆ©äº†çµ |
| æ¯æ—¥æœ€å¤§äº¤æ˜“æ¬¡æ•¸ | 10æ¬¡ | å…è¨±æ›´å¤šäº¤æ˜“ |
| é€£çºŒè™§æåœæ­¢ | 3æ¬¡ | é€£è™§3æ¬¡æš«åœ |
| å–®æ—¥æœ€å¤§è™§æ | -5% | é”åˆ°å¾Œæš«åœç•¶æ—¥äº¤æ˜“ |

#### å¯¦ä½œå½ä»£ç¢¼

```python
def rsi_strategy():
    # 1. å–å¾—æ•¸æ“š
    prices = redis.lrange('bot:qrl-usdt:price:history', 0, 19)
    
    # 2. è¨ˆç®—æŒ‡æ¨™
    rsi = calculate_rsi(prices[:14])
    bb_upper, bb_middle, bb_lower = calculate_bollinger_bands(prices[:20])
    current_price = float(prices[0])
    
    # 3. æª¢æŸ¥è¶¨å‹¢
    last_3_prices = [float(p) for p in prices[:3]]
    is_falling = all(last_3_prices[i] > last_3_prices[i+1] 
                     for i in range(len(last_3_prices)-1))
    is_rising = all(last_3_prices[i] < last_3_prices[i+1] 
                    for i in range(len(last_3_prices)-1))
    
    # 4. ç”Ÿæˆä¿¡è™Ÿ
    if rsi < 30 and is_falling and current_price < bb_lower:
        return "BUY"
    elif rsi > 70 and is_rising and current_price > bb_upper:
        return "SELL"
    else:
        return "HOLD"
```

### ç­–ç•¥ 3: ç¶²æ ¼äº¤æ˜“ (Grid Trading)

#### ç­–ç•¥é‚è¼¯

```
è¨­å®šåƒ¹æ ¼ç¶²æ ¼:
  åŸºæº–åƒ¹: 0.1200
  ç¶²æ ¼é–“è·: 2%
  ä¸Šé™: 0.1560 (+30%)
  ä¸‹é™: 0.0960 (-20%)
  
  ç¶²æ ¼åƒ¹ä½:
  [0.0960, 0.0979, 0.0999, 0.1019, 0.1039, 
   0.1200,  # åŸºæº–åƒ¹
   0.1224, 0.1248, 0.1273, 0.1298, 0.1560]

äº¤æ˜“è¦å‰‡:
  - åƒ¹æ ¼ä¸‹è·Œåˆ°ç¶²æ ¼ç·š â†’ è²·å…¥å›ºå®šé‡‘é¡
  - åƒ¹æ ¼ä¸Šæ¼²åˆ°ç¶²æ ¼ç·š â†’ è³£å‡ºå›ºå®šæ•¸é‡
  - æ¯å€‹ç¶²æ ¼åªäº¤æ˜“ä¸€æ¬¡
  - æ‰€æœ‰ç¶²æ ¼é‡ç½®æ™‚é‡æ–°é–‹å§‹
```

#### é¢¨æ§åƒæ•¸

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|-----|------|
| ç¸½æŠ•å…¥è³‡é‡‘ | 100 USDT | åˆ†æ•£åˆ°å„ç¶²æ ¼ |
| æ¯æ ¼æŠ•å…¥ | 10 USDT | 10å€‹ç¶²æ ¼ |
| ç¶²æ ¼é–“è· | 2% | å¹³è¡¡é »ç‡èˆ‡æ”¶ç›Š |
| é‡ç½®æ¢ä»¶ | åƒ¹æ ¼çªç ´ä¸Šä¸‹é™ | é‡æ–°è¨­å®šç¶²æ ¼ |

---

## ğŸ“Š ç›£æ§èˆ‡å‘Šè­¦

### éœ€è¦ç›£æ§çš„æŒ‡æ¨™

#### 1. ç³»çµ±å¥åº·æŒ‡æ¨™

```
ç›£æ§é …ç›®:
â”œâ”€ Cloud Run å¯¦ä¾‹ç‹€æ…‹
â”‚  â”œâ”€ å•Ÿå‹•æˆåŠŸç‡: > 99%
â”‚  â”œâ”€ å¹³å‡å•Ÿå‹•æ™‚é–“: < 2ç§’
â”‚  â””â”€ è¨˜æ†¶é«”ä½¿ç”¨ç‡: < 80%
â”‚
â”œâ”€ Redis é€£ç·šç‹€æ…‹
â”‚  â”œâ”€ é€£ç·šæˆåŠŸç‡: > 99.9%
â”‚  â”œâ”€ å¹³å‡å»¶é²: < 5ms
â”‚  â””â”€ é€£ç·šæ± ä½¿ç”¨ç‡: < 80%
â”‚
â”œâ”€ MEXC API å¥åº·åº¦
â”‚  â”œâ”€ API éŸ¿æ‡‰æ™‚é–“: < 1ç§’
â”‚  â”œâ”€ API éŒ¯èª¤ç‡: < 1%
â”‚  â””â”€ é€Ÿç‡é™åˆ¶ç‹€æ³: < 80%
â”‚
â””â”€ Cloud Scheduler åŸ·è¡Œ
   â”œâ”€ è§¸ç™¼æº–æ™‚ç‡: > 99%
   â””â”€ åŸ·è¡ŒæˆåŠŸç‡: > 98%
```

#### 2. äº¤æ˜“æ€§èƒ½æŒ‡æ¨™

```
ç›£æ§é …ç›®:
â”œâ”€ ä»Šæ—¥ç›ˆè™§
â”‚  â””â”€ å¯¦æ™‚è¨ˆç®—,æ¯æ¬¡äº¤æ˜“æ›´æ–°
â”‚
â”œâ”€ ç´¯è¨ˆç›ˆè™§
â”‚  â””â”€ å¾å•Ÿå‹•è‡³ä»Šçš„ç¸½ç›ˆè™§
â”‚
â”œâ”€ å‹ç‡
â”‚  â””â”€ ç›ˆåˆ©äº¤æ˜“æ•¸ / ç¸½äº¤æ˜“æ•¸ * 100%
â”‚
â”œâ”€ å¹³å‡ç›ˆè™§
â”‚  â”œâ”€ å¹³å‡æ¯ç­†ç›ˆåˆ©
â”‚  â””â”€ å¹³å‡æ¯ç­†è™§æ
â”‚
â”œâ”€ ç›ˆè™§æ¯”
â”‚  â””â”€ å¹³å‡ç›ˆåˆ© / å¹³å‡è™§æ
â”‚
â”œâ”€ äº¤æ˜“é »ç‡
â”‚  â”œâ”€ æ¯æ—¥äº¤æ˜“æ¬¡æ•¸
â”‚  â””â”€ å¹³å‡äº¤æ˜“é–“éš”
â”‚
â””â”€ æŒå€‰æ™‚é–“
   â”œâ”€ å¹³å‡æŒå€‰æ™‚é•·
   â””â”€ æœ€é•·æŒå€‰æ™‚é•·
```

#### 3. é¢¨éšªæŒ‡æ¨™

```
ç›£æ§é …ç›®:
â”œâ”€ ç•¶å‰å€‰ä½
â”‚  â”œâ”€ QRL æŒæœ‰æ•¸é‡
â”‚  â””â”€ ä½”ç¸½è³‡ç”¢æ¯”ä¾‹
â”‚
â”œâ”€ æœ€å¤§å›æ’¤
â”‚  â””â”€ å¾æœ€é«˜é»åˆ°æœ€ä½é»çš„è·Œå¹…
â”‚
â”œâ”€ é€£çºŒè™§ææ¬¡æ•¸
â”‚  â””â”€ é€£çºŒè™§æäº¤æ˜“çš„æ¬¡æ•¸
â”‚
â”œâ”€ å–®æ—¥è™§æé¡
â”‚  â””â”€ ç•¶æ—¥ç´¯è¨ˆè™§æé‡‘é¡
â”‚
â”œâ”€ é¤˜é¡è­¦å ±
â”‚  â”œâ”€ USDT é¤˜é¡ < 10
â”‚  â””â”€ ç¸½è³‡ç”¢ < åˆå§‹è³‡ç”¢çš„ 80%
â”‚
â””â”€ æ³¢å‹•ç‡
   â””â”€ æœ€è¿‘24å°æ™‚åƒ¹æ ¼æ³¢å‹•ç‡
```

### å‘Šè­¦è¨­å®š

#### Cloud Monitoring å‘Šè­¦ç­–ç•¥

```yaml
å‘Šè­¦ 1: API é€£ç·šå¤±æ•—
æ¢ä»¶:
  - MEXC API é€£çºŒå¤±æ•— >= 3æ¬¡
  - æ™‚é–“çª—å£: 5åˆ†é˜
åš´é‡æ€§: Critical
é€šçŸ¥ç®¡é“:
  - Email
  - Telegram
è¡Œå‹•:
  - æš«åœæ©Ÿå™¨äºº
  - è¨˜éŒ„éŒ¯èª¤æ—¥èªŒ

å‘Šè­¦ 2: å–®æ—¥è™§æè¶…é™
æ¢ä»¶:
  - å–®æ—¥è™§æ >= åˆå§‹è³‡ç”¢çš„ 5%
åš´é‡æ€§: Critical
é€šçŸ¥ç®¡é“:
  - Email
  - Telegram
  - SMS
è¡Œå‹•:
  - ç«‹å³åœæ­¢äº¤æ˜“
  - å¹³å€‰æ‰€æœ‰æŒå€‰

å‘Šè­¦ 3: Redis é€£ç·šä¸­æ–·
æ¢ä»¶:
  - Redis å¿ƒè·³è¶…æ™‚ > 5åˆ†é˜
åš´é‡æ€§: High
é€šçŸ¥ç®¡é“:
  - Email
è¡Œå‹•:
  - å˜—è©¦é‡æ–°é€£ç·š
  - åˆ‡æ›åˆ° Firestore å‚™ä»½

å‘Šè­¦ 4: é¤˜é¡ä¸è¶³
æ¢ä»¶:
  - USDT é¤˜é¡ < 10
åš´é‡æ€§: Medium
é€šçŸ¥ç®¡é“:
  - Email
è¡Œå‹•:
  - åœæ­¢é–‹æ–°å€‰
  - åƒ…å…è¨±å¹³å€‰æ“ä½œ

å‘Šè­¦ 5: é€£çºŒè™§æ
æ¢ä»¶:
  - é€£çºŒè™§æ >= 3æ¬¡
åš´é‡æ€§: Medium
é€šçŸ¥ç®¡é“:
  - Telegram
è¡Œå‹•:
  - æš«åœäº¤æ˜“ 1å°æ™‚
  - ç­‰å¾…äººå·¥ç¢ºèª

å‘Šè­¦ 6: ç•°å¸¸æ³¢å‹•
æ¢ä»¶:
  - 10åˆ†é˜å…§åƒ¹æ ¼æ³¢å‹• > 10%
åš´é‡æ€§: Low
é€šçŸ¥ç®¡é“:
  - Telegram
è¡Œå‹•:
  - è¨˜éŒ„äº‹ä»¶
  - ç¹¼çºŒç›£æ§
```

### ç›£æ§å„€è¡¨æ¿è¨­è¨ˆ

#### Dashboard 1: å³æ™‚äº¤æ˜“ç›£æ§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QRL/USDT è‡ªå‹•äº¤æ˜“æ©Ÿå™¨äºº - å³æ™‚ç›£æ§               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  ç•¶å‰ç‹€æ…‹: â— é‹è¡Œä¸­        æœ€å¾Œæ›´æ–°: 2ç§’å‰        â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ç•¶å‰åƒ¹æ ¼     â”‚  â”‚  24h è®ŠåŒ–    â”‚           â”‚
â”‚  â”‚  0.1234      â”‚  â”‚  +2.34%      â”‚           â”‚
â”‚  â”‚  USDT        â”‚  â”‚  â†‘           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  åƒ¹æ ¼èµ°å‹¢ (æœ€è¿‘1å°æ™‚)                      â”‚  â”‚
â”‚  â”‚                                            â”‚  â”‚
â”‚  â”‚  0.125 â”‚              â•±â•²                  â”‚  â”‚
â”‚  â”‚  0.124 â”‚           â•±â•²â•±  â•²                 â”‚  â”‚
â”‚  â”‚  0.123 â”‚        â•±â•²â•±      â•²â•±â•²              â”‚  â”‚
â”‚  â”‚  0.122 â”‚     â•±â•²â•±              â•²          â”‚  â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚  â”‚
â”‚  â”‚        10:00  10:15  10:30  10:45         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â”‚  å¸³æˆ¶è³‡è¨Š                                        â”‚
â”‚  â”œâ”€ USDT é¤˜é¡: 450.25                          â”‚
â”‚  â”œâ”€ QRL é¤˜é¡: 1,000.00                         â”‚
â”‚  â”œâ”€ ç¸½è³‡ç”¢: 573.65 USDT                        â”‚
â”‚  â””â”€ æŒå€‰ä½”æ¯”: 21.5%                            â”‚
â”‚                                                 â”‚
â”‚  ä»Šæ—¥çµ±è¨ˆ                                        â”‚
â”‚  â”œâ”€ äº¤æ˜“æ¬¡æ•¸: 3 / 5                            â”‚
â”‚  â”œâ”€ ç›ˆåˆ©äº¤æ˜“: 2                                â”‚
â”‚  â”œâ”€ è™§æäº¤æ˜“: 1                                â”‚
â”‚  â”œâ”€ ä»Šæ—¥ç›ˆè™§: +5.23 USDT (+0.91%)             â”‚
â”‚  â””â”€ å‹ç‡: 66.7%                                â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Dashboard 2: ç³»çµ±å¥åº·ç›£æ§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç³»çµ±å¥åº·ç›£æ§                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Cloud Run                                      â”‚
â”‚  â”œâ”€ ç‹€æ…‹: âœ“ æ­£å¸¸                               â”‚
â”‚  â”œâ”€ å¯¦ä¾‹æ•¸: 1                                   â”‚
â”‚  â”œâ”€ CPU: 15%                                    â”‚
â”‚  â”œâ”€ è¨˜æ†¶é«”: 120MB / 512MB (23%)                â”‚
â”‚  â””â”€ å¹³å‡éŸ¿æ‡‰æ™‚é–“: 1.2ç§’                        â”‚
â”‚                                                 â”‚
â”‚  Redis (Memorystore)                            â”‚
â”‚  â”œâ”€ ç‹€æ…‹: âœ“ æ­£å¸¸                               â”‚
â”‚  â”œâ”€ å»¶é²: 2.3ms                                â”‚
â”‚  â”œâ”€ é€£ç·šæ•¸: 3 / 10                             â”‚
â”‚  â”œâ”€ è¨˜æ†¶é«”ä½¿ç”¨: 45MB / 1GB (4.5%)              â”‚
â”‚  â””â”€ å‘½ä¸­ç‡: 98.5%                              â”‚
â”‚                                                 â”‚
â”‚  MEXC API                                       â”‚
â”‚  â”œâ”€ ç‹€æ…‹: âœ“ æ­£å¸¸                               â”‚
â”‚  â”œâ”€ å¹³å‡éŸ¿æ‡‰: 850ms                            â”‚
â”‚  â”œâ”€ æˆåŠŸç‡: 99.2%                              â”‚
â”‚  â”œâ”€ ä»Šæ—¥è«‹æ±‚: 287                              â”‚
â”‚  â””â”€ é€Ÿç‡é™åˆ¶: 287 / 1200 (23.9%)               â”‚
â”‚                                                 â”‚
â”‚  Cloud Scheduler                                â”‚
â”‚  â”œâ”€ ç‹€æ…‹: âœ“ æ­£å¸¸                               â”‚
â”‚  â”œâ”€ ä»Šæ—¥è§¸ç™¼: 145 / 145                        â”‚
â”‚  â”œâ”€ æˆåŠŸç‡: 100%                               â”‚
â”‚  â””â”€ ä¸‹æ¬¡åŸ·è¡Œ: 30ç§’å¾Œ                           â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€šçŸ¥ç¯„ä¾‹

#### Telegram é€šçŸ¥æ ¼å¼

```
ğŸ“Š QRL/USDT äº¤æ˜“é€šçŸ¥

âœ… äº¤æ˜“é¡å‹: è²·å…¥
ğŸ’° æ•¸é‡: 100 QRL
ğŸ’µ åƒ¹æ ¼: 0.1234 USDT
ğŸ“ˆ ç¸½é‡‘é¡: 12.34 USDT
â° æ™‚é–“: 2025-12-27 10:30:15

å¸³æˆ¶ç‹€æ…‹:
â”œâ”€ USDT: 437.91
â”œâ”€ QRL: 1,100.00
â””â”€ ç¸½è³‡ç”¢: 573.65 USDT

ç­–ç•¥: MAäº¤å‰ (MA5 ä¸Šç©¿ MA20)
```

---

## ğŸ’° æˆæœ¬ä¼°ç®— (æ¯æœˆ)

### è©³ç´°æˆæœ¬åˆ†æ

#### 1. Cloud Run

```yaml
ä½¿ç”¨å ´æ™¯: æ¯åˆ†é˜è§¸ç™¼ä¸€æ¬¡äº¤æ˜“æª¢æŸ¥

è¨ˆè²»é …ç›®:
  CPU æ™‚é–“:
    - åŸ·è¡Œæ™‚é–“: 20ç§’/æ¬¡
    - æ¯æœˆæ¬¡æ•¸: 60 * 24 * 30 = 43,200æ¬¡
    - ç¸½ CPU æ™‚é–“: 43,200 * 20 = 864,000ç§’ = 240 CPUå°æ™‚
    - å–®åƒ¹: $0.00002400 / vCPUç§’
    - æˆæœ¬: 864,000 * 0.00002400 = $20.74
  
  è¨˜æ†¶é«”:
    - è¨˜æ†¶é«”é…ç½®: 512MB
    - ç¸½è¨˜æ†¶é«”æ™‚é–“: 43,200 * 20 * 0.5 = 432,000 GBç§’
    - å–®åƒ¹: $0.00000250 / GBç§’
    - æˆæœ¬: 432,000 * 0.00000250 = $1.08
  
  è«‹æ±‚æ•¸:
    - æœˆè«‹æ±‚æ•¸: 43,200
    - å…è²»é¡åº¦: 2,000,000 (ä¸æ”¶è²»)
    - æˆæœ¬: $0
  
  ç¶²è·¯æµå‡º:
    - æ¯æ¬¡éŸ¿æ‡‰: ~5KB
    - ç¸½æµé‡: 43,200 * 5KB = 216MB
    - å…è²»é¡åº¦: 1GB (ä¸æ”¶è²»)
    - æˆæœ¬: $0

å°è¨ˆ: $21.82
```

#### 2. Memorystore for Redis

```yaml
å¯¦ä¾‹é…ç½®: Basic Tier, 1GB

è¨ˆè²»é …ç›®:
  å¯¦ä¾‹è²»ç”¨:
    - å–®åƒ¹: $0.049 / GB / å°æ™‚
    - æœˆå°æ™‚æ•¸: 24 * 30 = 720å°æ™‚
    - æˆæœ¬: 1 * 0.049 * 720 = $35.28
  
  ç¶²è·¯æµé‡:
    - åŒå€åŸŸå…§ç¶²å‚³è¼¸: å…è²»
    - æˆæœ¬: $0

å°è¨ˆ: $35.28
```

#### 3. Cloud Scheduler

```yaml
ä½œæ¥­æ•¸: 1 å€‹

è¨ˆè²»é …ç›®:
  ä½œæ¥­åŸ·è¡Œ:
    - æœˆåŸ·è¡Œæ¬¡æ•¸: 43,200
    - å…è²»é¡åº¦: 3 å€‹ä½œæ¥­ (å®Œå…¨å…è²»)
    - æˆæœ¬: $0

å°è¨ˆ: $0
```

#### 4. Cloud Logging

```yaml
æ—¥èªŒé‡ä¼°ç®—:
  æ¯æ¬¡åŸ·è¡Œæ—¥èªŒ: ~10KB
  æœˆç¸½æ—¥èªŒé‡: 43,200 * 10KB = 432MB

è¨ˆè²»é …ç›®:
  æ—¥èªŒæ”å–:
    - å…è²»é¡åº¦: 50GB (ä¸æ”¶è²»)
    - æˆæœ¬: $0
  
  æ—¥èªŒå­˜å„²:
    - å­˜å„²æ™‚é–“: 30å¤©
    - ç¸½å­˜å„²é‡: 432MB * 30 = 12.96GB
    - å…è²»é¡åº¦: 50GB (ä¸æ”¶è²»)
    - æˆæœ¬: $0

å°è¨ˆ: $0
```

#### 5. Firestore (å¯é¸)

```yaml
ä½¿ç”¨å ´æ™¯: å­˜å„²é•·æœŸäº¤æ˜“è¨˜éŒ„

æ•¸æ“šé‡ä¼°ç®—:
  æ¯ç­†äº¤æ˜“è¨˜éŒ„: ~1KB
  æ¯æ—¥äº¤æ˜“: 5ç­†
  æœˆç¸½æ•¸æ“š: 5 * 30 * 1KB = 150KB

è¨ˆè²»é …ç›®:
  å­˜å„²:
    - æœˆç¸½é‡: 150KB
    - å–®åƒ¹: $0.18 / GB / æœˆ
    - æˆæœ¬: 0.00015 * 0.18 = $0.00003
  
  è®€å–æ“ä½œ:
    - æœˆè®€å–: 1,000æ¬¡
    - å…è²»é¡åº¦: 50,000 (ä¸æ”¶è²»)
    - æˆæœ¬: $0
  
  å¯«å…¥æ“ä½œ:
    - æœˆå¯«å…¥: 150æ¬¡
    - å…è²»é¡åº¦: 20,000 (ä¸æ”¶è²»)
    - æˆæœ¬: $0

å°è¨ˆ: $0.00003 (å¯å¿½ç•¥)
```

#### 6. Secret Manager (å­˜å„² API Key)

```yaml
å¯†é‘°æ•¸é‡: 1 å€‹ (MEXC API Key)

è¨ˆè²»é …ç›®:
  å¯†é‘°ç‰ˆæœ¬:
    - æ•¸é‡: 1
    - å…è²»é¡åº¦: 6 å€‹ (ä¸æ”¶è²»)
    - æˆæœ¬: $0
  
  è¨ªå•æ¬¡æ•¸:
    - æœˆè¨ªå•: 43,200 (æ¯æ¬¡åŸ·è¡Œè®€å–)
    - å…è²»é¡åº¦: 10,000
    - è¶…é¡: 43,200 - 10,000 = 33,200
    - å–®åƒ¹: $0.03 / 10,000æ¬¡
    - æˆæœ¬: (33,200 / 10,000) * 0.03 = $0.10

å°è¨ˆ: $0.10
```

#### 7. Cloud Monitoring (å‘Šè­¦)

```yaml
å‘Šè­¦ç­–ç•¥: 6 å€‹

è¨ˆè²»é …ç›®:
  å‘Šè­¦ç­–ç•¥:
    - å…è²»é¡åº¦: 100 å€‹ (ä¸æ”¶è²»)
    - æˆæœ¬: $0
  
  æŒ‡æ¨™æ”å–:
    - æœˆæŒ‡æ¨™æ•¸: ~5,000 å€‹
    - å…è²»é¡åº¦: 150 MB (ä¸æ”¶è²»)
    - æˆæœ¬: $0

å°è¨ˆ: $0
```

### ç¸½æˆæœ¬å½™ç¸½

| æœå‹™ | æœˆè²»ç”¨ (USD) | ä½”æ¯” |
|------|-------------|------|
| Cloud Run | $21.82 | 38% |
| Memorystore (Redis) | $35.28 | 61% |
| Cloud Scheduler | $0 | 0% |
| Cloud Logging | $0 | 0% |
| Firestore | $0.00003 | 0% |
| Secret Manager | $0.10 | 0.2% |
| Cloud Monitoring | $0 | 0% |
| **ç¸½è¨ˆ** | **$57.20** | **100%** |

### æˆæœ¬å„ªåŒ–å»ºè­°

#### å„ªåŒ–æ–¹æ¡ˆ 1: é™ä½è§¸ç™¼é »ç‡

```
ç•¶å‰: æ¯1åˆ†é˜è§¸ç™¼
å„ªåŒ–: æ”¹ç‚ºæ¯5åˆ†é˜è§¸ç™¼

ç¯€çœ:
â”œâ”€ Cloud Run: $21.82 â†’ $4.36 (ç¯€çœ $17.46)
â””â”€ æœˆç¸½æˆæœ¬: $57.20 â†’ $39.74 (ç¯€çœ 30%)

é©ç”¨å ´æ™¯: ä½é »äº¤æ˜“ç­–ç•¥
```

#### å„ªåŒ–æ–¹æ¡ˆ 2: ä½¿ç”¨ Cloud Run Jobs

```
ç•¶å‰: æŒçºŒé‹è¡Œ Service
å„ªåŒ–: æ”¹ç”¨ Cloud Run Jobs (åƒ…åœ¨éœ€è¦æ™‚é‹è¡Œ)

ç¯€çœ:
â”œâ”€ ç„¡éœ€ VPC Connector å¸¸é§
â””â”€ æŒ‰éœ€è¨ˆè²»,æ›´éˆæ´»

é©ç”¨å ´æ™¯: æ¯æ—¥1-2æ¬¡çš„å¤§æ‰¹é‡åˆ†æä»»å‹™
```

#### å„ªåŒ–æ–¹æ¡ˆ 3: Redis å¯¦ä¾‹å„ªåŒ–

```
ç•¶å‰: Basic Tier 1GB
å„ªåŒ–æ–¹æ¡ˆ:
  A. é™ç´šè‡³ 0.5GB (å¦‚æœæ•¸æ“šé‡å°)
     â””â”€ $35.28 â†’ $17.64 (ç¯€çœ 50%)
  
  B. åƒ…åœ¨äº¤æ˜“æ™‚æ®µé‹è¡Œ (å¦‚: äº¤æ˜“æ‰€é–‹å¸‚æ™‚)
     â””â”€ è‡ªå‹•åŒ–å•Ÿåœå¯¦ä¾‹
     â””â”€ ç¯€çœ ~60% æˆæœ¬

æ³¨æ„: Basic Tier ä¸æ”¯æŒè‡ªå‹•ç¸®å®¹
```

#### å„ªåŒ–æ–¹æ¡ˆ 4: æ‰¹æ¬¡è™•ç†

```
ç•¶å‰: æ¯æ¬¡è§¸ç™¼åŸ·è¡Œå®Œæ•´æµç¨‹
å„ªåŒ–: å°‡å¤šå€‹è¼•é‡ç´šæª¢æŸ¥åˆä½µ

ç¯„ä¾‹:
â”œâ”€ åƒ¹æ ¼æ›´æ–°: æ¯1åˆ†é˜
â”œâ”€ æŠ€è¡“æŒ‡æ¨™è¨ˆç®—: æ¯5åˆ†é˜
â””â”€ äº¤æ˜“æ±ºç­–: æ¯15åˆ†é˜

é æœŸç¯€çœ: 40-50% Cloud Run æˆæœ¬
```

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿæ¦‚è¦

### Phase 1: åŸºç¤è¨­æ–½å»ºç½® (30åˆ†é˜)

#### æ­¥é©Ÿ 1.1: å»ºç«‹ GCP å°ˆæ¡ˆ

```bash
# 1. å»ºç«‹å°ˆæ¡ˆ
gcloud projects create trading-bot-project --name="Trading Bot"

# 2. è¨­å®šç‚ºç•¶å‰å°ˆæ¡ˆ
gcloud config set project trading-bot-project

# 3. å•Ÿç”¨è¨ˆè²»å¸³æˆ¶
gcloud beta billing projects link trading-bot-project \
  --billing-account=BILLING_ACCOUNT_ID

# 4. å•Ÿç”¨æ‰€éœ€ API
gcloud services enable \
  run.googleapis.com \
  cloudscheduler.googleapis.com \
  redis.googleapis.com \
  vpcaccess.googleapis.com \
  secretmanager.googleapis.com \
  logging.googleapis.com \
  monitoring.googleapis.com
```

#### æ­¥é©Ÿ 1.2: å»ºç«‹ VPC èˆ‡ Connector

```bash
# 1. å»ºç«‹ VPC ç¶²è·¯ (å¦‚ä½¿ç”¨è‡ªè¨‚ç¶²è·¯)
gcloud compute networks create trading-bot-vpc \
  --subnet-mode=custom

# 2. å»ºç«‹å­ç¶²è·¯
gcloud compute networks subnets create trading-bot-subnet \
  --network=trading-bot-vpc \
  --region=asia-southeast1 \
  --range=10.0.0.0/24

# 3. å»ºç«‹ Serverless VPC Access Connector
gcloud compute networks vpc-access connectors create trading-bot-connector \
  --region=asia-southeast1 \
  --subnet=trading-bot-subnet \
  --min-instances=2 \
  --max-instances=10 \
  --machine-type=e2-micro
```

#### æ­¥é©Ÿ 1.3: å»ºç«‹ Redis å¯¦ä¾‹

```bash
# å»ºç«‹ Memorystore Redis å¯¦ä¾‹
gcloud redis instances create trading-bot-redis \
  --size=1 \
  --region=asia-southeast1 \
  --zone=asia-southeast1-a \
  --network=trading-bot-vpc \
  --redis-version=redis_7_0 \
  --tier=basic \
  --enable-auth

# å–å¾— Redis é€£ç·šè³‡è¨Š
gcloud redis instances describe trading-bot-redis \
  --region=asia-southeast1
```

#### æ­¥é©Ÿ 1.4: å­˜å„² API å¯†é‘°

```bash
# 1. å»ºç«‹ Secret
echo -n "YOUR_MEXC_API_KEY" | \
  gcloud secrets create mexc-api-key --data-file=-

echo -n "YOUR_MEXC_SECRET_KEY" | \
  gcloud secrets create mexc-secret-key --data-file=-

echo -n "YOUR_REDIS_PASSWORD" | \
  gcloud secrets create redis-password --data-file=-

# 2. æˆäºˆ Cloud Run æœå‹™å¸³æˆ¶è¨ªå•æ¬Šé™
gcloud secrets add-iam-policy-binding mexc-api-key \
  --member="serviceAccount:PROJECT_NUMBER-compute@developer.gserviceaccount.com" \
  --role="roles/secretmanager.secretAccessor"
```

### Phase 2: æ©Ÿå™¨äººé–‹ç™¼ (2-4å°æ™‚)

#### æ­¥é©Ÿ 2.1: å°ˆæ¡ˆçµæ§‹

```
trading-bot/
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt (æˆ– package.json)
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py (æˆ– index.ts)
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â”œâ”€â”€ ma_crossover.py
â”‚   â”‚   â””â”€â”€ rsi_strategy.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ redis_service.py
â”‚   â”‚   â”œâ”€â”€ mexc_service.py
â”‚   â”‚   â””â”€â”€ firestore_service.py
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ indicators.py
â”‚       â””â”€â”€ risk_manager/core.py
â””â”€â”€ tests/
    â””â”€â”€ test_strategies.py
```

#### æ­¥é©Ÿ 2.2: Dockerfile ç¯„ä¾‹

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£ä¾è³´
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# è¤‡è£½ç¨‹å¼ç¢¼
COPY src/ ./src/

# è¨­å®šç’°å¢ƒè®Šæ•¸
ENV PORT=8080
ENV PYTHONUNBUFFERED=1

# å•Ÿå‹•æ‡‰ç”¨
CMD exec gunicorn --bind :$PORT --workers 1 --threads 8 --timeout 60 src.main:app
```

#### æ­¥é©Ÿ 2.3: æ ¸å¿ƒç¨‹å¼æ¶æ§‹ (Python ç¯„ä¾‹)

```python
# main.py
from flask import Flask, request, jsonify
import redis
from strategies import ma_crossover
from services import mexc_service, redis_service

app = Flask(__name__)

@app.route('/execute', methods=['POST'])
def execute_trade():
    try:
        # 1. é©—è­‰è«‹æ±‚
        data = request.json
        
        # 2. æª¢æŸ¥æ©Ÿå™¨äººç‹€æ…‹
        status = redis_service.get_bot_status()
        if status == 'paused':
            return jsonify({'status': 'paused'}), 200
        
        # 3. å–å¾—å¸‚å ´æ•¸æ“š
        price_data = mexc_service.get_ticker('QRLUSDT')
        
        # 4. åŸ·è¡Œç­–ç•¥
        signal = ma_crossover.analyze(price_data)
        
        # 5. é¢¨éšªæ§åˆ¶
        if should_execute(signal):
            order = mexc_service.place_order(signal)
            redis_service.update_position(order)
        
        return jsonify({
            'status': 'success',
            'signal': signal
        }), 200
        
    except Exception as e:
        logging.error(f"Error: {e}")
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### Phase 3: éƒ¨ç½²åˆ° Cloud Run (15åˆ†é˜)

#### æ­¥é©Ÿ 3.1: å»ºç½®ä¸¦æ¨é€æ˜ åƒ

```bash
# 1. è¨­å®š Artifact Registry
gcloud artifacts repositories create trading-bot-repo \
  --repository-format=docker \
  --location=asia-southeast1

# 2. å»ºç½®æ˜ åƒ
gcloud builds submit --tag asia-southeast1-docker.pkg.dev/PROJECT_ID/trading-bot-repo/trading-bot:v1

# æˆ–ä½¿ç”¨æœ¬åœ° Docker
docker build -t asia-southeast1-docker.pkg.dev/PROJECT_ID/trading-bot-repo/trading-bot:v1 .
docker push asia-southeast1-docker.pkg.dev/PROJECT_ID/trading-bot-repo/trading-bot:v1
```

#### æ­¥é©Ÿ 3.2: éƒ¨ç½² Cloud Run Service

```bash
gcloud run deploy trading-bot \
  --image=asia-southeast1-docker.pkg.dev/PROJECT_ID/trading-bot-repo/trading-bot:v1 \
  --platform=managed \
  --region=asia-southeast1 \
  --vpc-connector=trading-bot-connector \
  --vpc-egress=private-ranges-only \
  --memory=512Mi \
  --cpu=1 \
  --timeout=60s \
  --min-instances=0 \
  --max-instances=1 \
  --set-env-vars="REDIS_HOST=10.0.0.3,REDIS_PORT=6379" \
  --set-secrets="MEXC_API_KEY=mexc-api-key:latest,MEXC_SECRET_KEY=mexc-secret-key:latest,REDIS_PASSWORD=redis-password:latest" \
  --no-allow-unauthenticated
```

### Phase 4: è¨­å®š Cloud Scheduler (10åˆ†é˜)

#### æ­¥é©Ÿ 4.1: å»ºç«‹æœå‹™å¸³æˆ¶

```bash
# 1. å»ºç«‹æœå‹™å¸³æˆ¶
gcloud iam service-accounts create trading-bot-scheduler \
  --display-name="Trading Bot Scheduler"

# 2. æˆäºˆ Cloud Run Invoker è§’è‰²
gcloud run services add-iam-policy-binding trading-bot \
  --region=asia-southeast1 \
  --member="serviceAccount:trading-bot-scheduler@PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/run.invoker"
```

#### æ­¥é©Ÿ 4.2: å»ºç«‹æ’ç¨‹ä½œæ¥­

```bash
# å–å¾— Cloud Run URL
SERVICE_URL=$(gcloud run services describe trading-bot \
  --region=asia-southeast1 \
  --format='value(status.url)')

# å»ºç«‹ Scheduler ä½œæ¥­ (æ¯åˆ†é˜åŸ·è¡Œ)
gcloud scheduler jobs create http trading-bot-trigger \
  --location=asia-southeast1 \
  --schedule="*/1 * * * *" \
  --uri="${SERVICE_URL}/execute" \
  --http-method=POST \
  --headers="Content-Type=application/json" \
  --message-body='{"pair":"QRL/USDT","strategy":"ma-crossover"}' \
  --oidc-service-account-email=trading-bot-scheduler@PROJECT_ID.iam.gserviceaccount.com \
  --oidc-token-audience="${SERVICE_URL}"
```

### Phase 5: æ¸¬è©¦èˆ‡é©—è­‰ (30åˆ†é˜)

#### æ¸¬è©¦æª¢æŸ¥æ¸…å–®

```
âœ“ åŸºç¤è¨­æ–½æ¸¬è©¦
  â”œâ”€ VPC Connector é€£ç·šæ­£å¸¸
  â”œâ”€ Redis å¯¦ä¾‹å¯è¨ªå•
  â””â”€ Cloud Run æœå‹™å¯å•Ÿå‹•

âœ“ API é€£ç·šæ¸¬è©¦
  â”œâ”€ MEXC API èªè­‰æˆåŠŸ
  â”œâ”€ å¸‚å ´æ•¸æ“šå–å¾—æ­£å¸¸
  â””â”€ é¤˜é¡æŸ¥è©¢æ­£å¸¸

âœ“ Redis æ“ä½œæ¸¬è©¦
  â”œâ”€ å¯«å…¥æ•¸æ“šæˆåŠŸ
  â”œâ”€ è®€å–æ•¸æ“šæ­£ç¢º
  â””â”€ TTL è¨­å®šç”Ÿæ•ˆ

âœ“ ç­–ç•¥åŸ·è¡Œæ¸¬è©¦
  â”œâ”€ æŠ€è¡“æŒ‡æ¨™è¨ˆç®—æ­£ç¢º
  â”œâ”€ äº¤æ˜“ä¿¡è™Ÿç”Ÿæˆæ­£å¸¸
  â””â”€ é¢¨éšªæ§åˆ¶è§¸ç™¼æ­£ç¢º

âœ“ ç«¯åˆ°ç«¯æ¸¬è©¦
  â”œâ”€ Scheduler è§¸ç™¼æˆåŠŸ
  â”œâ”€ äº¤æ˜“æµç¨‹å®Œæ•´åŸ·è¡Œ
  â””â”€ æ—¥èªŒè¨˜éŒ„å®Œæ•´

âœ“ å‘Šè­¦æ¸¬è©¦
  â”œâ”€ éŒ¯èª¤å‘Šè­¦è§¸ç™¼
  â””â”€ é€šçŸ¥ç™¼é€æˆåŠŸ
```

#### æ‰‹å‹•è§¸ç™¼æ¸¬è©¦

```bash
# 1. æ‰‹å‹•è§¸ç™¼ Scheduler
gcloud scheduler jobs run trading-bot-trigger --location=asia-southeast1

# 2. æŸ¥çœ‹æ—¥èªŒ
gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=trading-bot" \
  --limit=50 \
  --format=json

# 3. æª¢æŸ¥ Redis æ•¸æ“š
# é€£æ¥åˆ° Redis (éœ€è¦é€šé Cloud Shell æˆ–æœ‰æ¬Šé™çš„ VM)
redis-cli -h 10.0.0.3 -a YOUR_REDIS_PASSWORD
> GET bot:qrl-usdt:price:latest
> LRANGE bot:qrl-usdt:price:history 0 10
```

### Phase 6: ç›£æ§è¨­å®š (20åˆ†é˜)

#### æ­¥é©Ÿ 6.1: å»ºç«‹ Dashboard

```bash
# ä½¿ç”¨ Cloud Console å»ºç«‹ Monitoring Dashboard
# æˆ–ä½¿ç”¨ Terraform/gcloud CLI è‡ªå‹•åŒ–
```

#### æ­¥é©Ÿ 6.2: è¨­å®šå‘Šè­¦ç­–ç•¥

```bash
# ç¯„ä¾‹: CPU ä½¿ç”¨ç‡å‘Šè­¦
gcloud alpha monitoring policies create \
  --notification-channels=CHANNEL_ID \
  --display-name="Cloud Run High CPU" \
  --condition-display-name="CPU > 80%" \
  --condition-threshold-value=0.8 \
  --condition-threshold-duration=300s
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. å®‰å…¨æ€§

#### API å¯†é‘°ç®¡ç†

```
âœ“ ä½¿ç”¨ Secret Manager å­˜å„²å¯†é‘°
âœ— çµ•ä¸å°‡å¯†é‘°å¯«å…¥ç¨‹å¼ç¢¼æˆ– Git

âœ“ å®šæœŸè¼ªæ› API å¯†é‘° (å»ºè­°æ¯30å¤©)
âœ“ ä½¿ç”¨ IP ç™½åå–®é™åˆ¶ API è¨ªå•
âœ“ é™åˆ¶ API Key æ¬Šé™ (åƒ…äº¤æ˜“,ä¸è¦æå¹£)
```

#### æœå‹™å¸³æˆ¶æ¬Šé™

```
æœ€å°æ¬Šé™åŸå‰‡:
â”œâ”€ Cloud Run â†’ åƒ…éœ€ Secret Accessor
â”œâ”€ Scheduler â†’ åƒ…éœ€ Run Invoker
â””â”€ Monitoring â†’ åƒ…éœ€ Metric Writer

ç¦æ­¢:
â””â”€ Owner / Editor ç­‰é«˜æ¬Šé™è§’è‰²
```

#### ç¶²è·¯å®‰å…¨

```
âœ“ Redis åƒ…å…è¨± VPC å…§éƒ¨è¨ªå•
âœ“ Cloud Run ä½¿ç”¨èªè­‰çš„ OIDC token
âœ“ ç¦ç”¨ Cloud Run çš„å…¬é–‹è¨ªå•
```

### 2. å†ªç­‰æ€§è¨­è¨ˆ

#### å•é¡Œå ´æ™¯

```
Scheduler è§¸ç™¼ â†’ Cloud Run åŸ·è¡Œ â†’ ä¸‹å–®æˆåŠŸ
                                 â†“
                           ä½†éŸ¿æ‡‰è¶…æ™‚
                                 â†“
                         Scheduler é‡è©¦
                                 â†“
                          é‡è¤‡ä¸‹å–®! âŒ
```

#### è§£æ±ºæ–¹æ¡ˆ

```python
# ä½¿ç”¨ Redis SETNX å¯¦ç¾åˆ†æ•£å¼é–
def execute_trade_with_lock():
    lock_key = f"bot:qrl-usdt:lock:{minute_timestamp}"
    
    # å˜—è©¦ç²å–é– (60ç§’æœ‰æ•ˆ)
    if redis.set(lock_key, "1", nx=True, ex=60):
        try:
            # åŸ·è¡Œäº¤æ˜“é‚è¼¯
            result = perform_trading()
            return result
        finally:
            # é‡‹æ”¾é–
            redis.delete(lock_key)
    else:
        # å·²æœ‰å¯¦ä¾‹åœ¨åŸ·è¡Œ,è·³é
        return {"status": "skipped", "reason": "already_running"}
```

### 3. éŒ¯èª¤è™•ç†ç­–ç•¥

#### API éŒ¯èª¤è™•ç†

```python
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

# é…ç½®é‡è©¦ç­–ç•¥
retry_strategy = Retry(
    total=3,
    status_forcelist=[429, 500, 502, 503, 504],
    backoff_factor=1,  # 1s, 2s, 4s
    allowed_methods=["GET", "POST"]
)

adapter = HTTPAdapter(max_retries=retry_strategy)
session = requests.Session()
session.mount("https://", adapter)

# ä½¿ç”¨ session å‘¼å« MEXC API
try:
    response = session.post(
        "https://api.mexc.com/api/v3/order",
        json=order_params,
        timeout=5
    )
    response.raise_for_status()
except requests.exceptions.RequestException as e:
    logging.error(f"API Error: {e}")
    # é™ç´šè™•ç†: è¨˜éŒ„éŒ¯èª¤,ä¸ä¸‹å–®
    return {"status": "error", "message": str(e)}
```

#### éƒ¨åˆ†å¤±æ•—è™•ç†

```python
def execute_trading_cycle():
    """
    å³ä½¿æŸäº›æ­¥é©Ÿå¤±æ•—,ä¹Ÿè¦ç›¡å¯èƒ½å®Œæˆå…¶ä»–æ­¥é©Ÿ
    """
    results = {
        'price_fetch': False,
        'balance_fetch': False,
        'signal_generated': False,
        'order_placed': False
    }
    
    # 1. å–å¾—åƒ¹æ ¼ (critical)
    try:
        price = fetch_price()
        results['price_fetch'] = True
    except Exception as e:
        logging.error(f"Price fetch failed: {e}")
        return results  # ç„¡åƒ¹æ ¼ç„¡æ³•ç¹¼çºŒ
    
    # 2. å–å¾—é¤˜é¡ (non-critical)
    try:
        balance = fetch_balance()
        results['balance_fetch'] = True
    except Exception as e:
        logging.warning(f"Balance fetch failed: {e}")
        balance = get_cached_balance()  # ä½¿ç”¨å¿«å–
    
    # 3. ç”Ÿæˆä¿¡è™Ÿ
    try:
        signal = generate_signal(price)
        results['signal_generated'] = True
    except Exception as e:
        logging.error(f"Signal generation failed: {e}")
        return results
    
    # 4. ä¸‹å–® (å¦‚æœä¿¡è™Ÿç‚º BUY/SELL)
    if signal in ['BUY', 'SELL']:
        try:
            order = place_order(signal, balance)
            results['order_placed'] = True
        except Exception as e:
            logging.error(f"Order failed: {e}")
            send_alert(f"ä¸‹å–®å¤±æ•—: {e}")
    
    return results
```

### 4. MEXC API é™åˆ¶

#### é€Ÿç‡é™åˆ¶

```
MEXC API é™åˆ¶ (v3):
â”œâ”€ å¸‚å ´æ•¸æ“š: 20 è«‹æ±‚/ç§’
â”œâ”€ å¸³æˆ¶æŸ¥è©¢: 5 è«‹æ±‚/ç§’
â”œâ”€ ä¸‹å–®: 50 è«‹æ±‚/10ç§’
â””â”€ å–æ¶ˆè¨‚å–®: 50 è«‹æ±‚/10ç§’

æˆ‘å€‘çš„æ©Ÿå™¨äºº (æ¯åˆ†é˜è§¸ç™¼):
â”œâ”€ å¸‚å ´æ•¸æ“š: 1 è«‹æ±‚/åˆ†é˜ âœ“
â”œâ”€ å¸³æˆ¶æŸ¥è©¢: 1 è«‹æ±‚/åˆ†é˜ âœ“
â””â”€ ä¸‹å–®: æœ€å¤š 5 è«‹æ±‚/å¤© âœ“

çµè«–: é ä½æ–¼é™åˆ¶,å®‰å…¨
```

#### å¯¦ä½œé€Ÿç‡é™åˆ¶æ§åˆ¶

```python
import time
from collections import deque

class RateLimiter:
    def __init__(self, max_calls, time_window):
        self.max_calls = max_calls
        self.time_window = time_window
        self.calls = deque()
    
    def __call__(self, func):
        def wrapper(*args, **kwargs):
            now = time.time()
            
            # ç§»é™¤è¶…å‡ºæ™‚é–“çª—å£çš„è¨˜éŒ„
            while self.calls and self.calls[0] < now - self.time_window:
                self.calls.popleft()
            
            # æª¢æŸ¥æ˜¯å¦è¶…éé™åˆ¶
            if len(self.calls) >= self.max_calls:
                sleep_time = self.time_window - (now - self.calls[0])
                logging.warning(f"Rate limit reached, sleeping {sleep_time}s")
                time.sleep(sleep_time)
            
            # åŸ·è¡Œå‡½æ•¸
            self.calls.append(now)
            return func(*args, **kwargs)
        
        return wrapper

# ä½¿ç”¨ç¯„ä¾‹
@RateLimiter(max_calls=5, time_window=1)  # æ¯ç§’æœ€å¤š5æ¬¡
def fetch_account_info():
    return mexc_api.get_account()
```

### 5. ç½é›£æ¢å¾©

#### Redis æ•¸æ“šå‚™ä»½

```bash
# å®šæœŸå‚™ä»½ Redis æ•¸æ“šåˆ° Cloud Storage
# ä½¿ç”¨ Cloud Scheduler è§¸ç™¼

# backup.sh
redis-cli -h 10.0.0.3 -a $REDIS_PASSWORD SAVE
gsutil cp /var/lib/redis/dump.rdb \
  gs://trading-bot-backups/redis-$(date +%Y%m%d-%H%M%S).rdb
```

#### é™ç´šç­–ç•¥

```python
def get_price_with_fallback():
    """
    åƒ¹æ ¼ç²å–çš„é™ç´šéˆ
    """
    try:
        # 1. å˜—è©¦å¾ MEXC API
        return mexc_api.get_ticker('QRLUSDT')['price']
    except Exception as e:
        logging.warning(f"MEXC API failed: {e}")
        
        try:
            # 2. å˜—è©¦å¾ Redis å¿«å–
            cached = redis.get('bot:qrl-usdt:price:latest')
            if cached:
                return float(cached)
        except Exception as e:
            logging.warning(f"Redis failed: {e}")
            
            try:
                # 3. å˜—è©¦å¾ Firestore å‚™ä»½
                doc = firestore.collection('prices').document('latest').get()
                return doc.to_dict()['price']
            except Exception as e:
                logging.error(f"All price sources failed: {e}")
                
                # 4. æœ€çµ‚é™ç´š: æ‹’çµ•äº¤æ˜“
                raise Exception("Cannot fetch price from any source")
```

### 6. åˆè¦æ€§èˆ‡æ³•å¾‹

#### äº¤æ˜“æ‰€è¦å‰‡

```
MEXC è¦å‰‡:
âœ“ éµå®ˆ API é€Ÿç‡é™åˆ¶
âœ“ ä¸å¾—ä½¿ç”¨è‡ªå‹•åŒ–ç¨‹åºæ“ç¸±å¸‚å ´
âœ“ ç¦æ­¢å¥—åˆ©/æ¶å…ˆäº¤æ˜“
âœ“ éœ€è¦é€šé KYC é©—è­‰

æˆ‘å€‘çš„æ©Ÿå™¨äºº:
âœ“ åƒ…è‡ªå‹•åŒ–å€‹äººäº¤æ˜“æ±ºç­–
âœ“ ç„¡å¸‚å ´æ“ç¸±è¡Œç‚º
âœ“ éµå®ˆæ‰€æœ‰ API é™åˆ¶
```

#### ç¨…å‹™è€ƒé‡

```
é‡è¦æé†’:
â”œâ”€ è¨˜éŒ„æ‰€æœ‰äº¤æ˜“ç”¨æ–¼å ±ç¨…
â”œâ”€ åŠ å¯†è²¨å¹£äº¤æ˜“å¯èƒ½éœ€è¦ç¹³ç¨…
â”œâ”€ è«®è©¢ç•¶åœ°ç¨…å‹™å°ˆæ¥­äººå£«
â””â”€ Firestore è¨˜éŒ„å¯ä½œç‚ºç¨…å‹™æ†‘è­‰
```

#### é¢¨éšªè²æ˜

```
âš ï¸ é¢¨éšªè­¦å‘Š:
1. åŠ å¯†è²¨å¹£äº¤æ˜“æœ‰é«˜åº¦é¢¨éšª
2. è‡ªå‹•äº¤æ˜“æ©Ÿå™¨äººå¯èƒ½è™§æ
3. éå»è¡¨ç¾ä¸ä»£è¡¨æœªä¾†çµæœ
4. åƒ…æŠ•å…¥å¯æ‰¿å—æå¤±çš„è³‡é‡‘
5. å®šæœŸç›£æ§æ©Ÿå™¨äººé‹ä½œ
6. å»ºè­°å¾å°é¡é–‹å§‹æ¸¬è©¦
```

---

## ğŸ“š å»¶ä¼¸é–±è®€

### æŠ€è¡“æ–‡æª”

- [Cloud Run å®˜æ–¹æ–‡æª”](https://cloud.google.com/run/docs)
- [Memorystore for Redis æ–‡æª”](https://cloud.google.com/memorystore/docs/redis)
- [MEXC API v3 æ–‡æª”](https://mexcdevelop.github.io/apidocs/spot_v3_en/)
- [Cloud Scheduler æ–‡æª”](https://cloud.google.com/scheduler/docs)

### äº¤æ˜“ç­–ç•¥

- [TradingView æŠ€è¡“åˆ†ææ•™å­¸](https://www.tradingview.com/wiki/)
- [é‡åŒ–äº¤æ˜“ç­–ç•¥](https://www.quantstart.com/)
- [Python é‡åŒ–äº¤æ˜“æ¡†æ¶](https://github.com/quantopian/zipline)

### æœ€ä½³å¯¦è¸

- [Google Cloud æ¶æ§‹ä¸­å¿ƒ](https://cloud.google.com/architecture)
- [å¾®æœå‹™è¨­è¨ˆæ¨¡å¼](https://microservices.io/patterns/)
- [Redis æœ€ä½³å¯¦è¸](https://redis.io/docs/manual/patterns/)

---

## ğŸ“ æ”¯æ´èˆ‡å”åŠ©

å¦‚éœ€é€²ä¸€æ­¥å”åŠ©,è«‹è¯ç¹«:
- æŠ€è¡“å•é¡Œ: support@example.com
- ç­–ç•¥è«®è©¢: trading@example.com

---

**æ–‡æª”ç‰ˆæœ¬:** 1.0.0  
**æœ€å¾Œæ›´æ–°:** 2025-12-27  
**ä½œè€…:** Claude AI Assistant